<!DOCTYPE html>
<html lang="pt-pt" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clever Advertising - Dashboard N1</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@700&family=Figtree:wght@400;600&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        /* --- Design System --- */
        :root {
            --color-bg: #f4f4f4;
            --color-card-bg: #ffffff;
            --color-text: #24282A;
            --color-text-muted: #6c757d;
            --color-header: #231372;
            --color-accent: #20E2C8;
            --color-sidebar: #ffffff;
            --color-border: #e0e0e0;
            --color-table-header: rgba(35, 19, 114, 0.05);
            
            --font-text: 'Figtree', sans-serif;
            --font-header: 'Barlow', sans-serif;
            
            --sidebar-width: 280px; 
            --transition-speed: 0.3s;
        }

        [data-theme="dark"] {
            --color-bg: #121418;
            --color-card-bg: #1e2228;
            --color-text: #ecf0f1;
            --color-text-muted: #aab0c6;
            --color-header: #ffffff;
            --color-sidebar: #1e2228;
            --color-border: #2c3036;
            --color-table-header: rgba(255,255,255,0.05);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background-color: var(--color-bg);
            font-family: var(--font-text);
            color: var(--color-text);
            line-height: 1.6;
            transition: background-color var(--transition-speed), color var(--transition-speed);
            display: flex;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* --- Sidebar --- */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--color-sidebar);
            border-right: 1px solid var(--color-border);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 100;
        }

        .sidebar-header {
            padding: 30px 20px;
            background-color: var(--color-sidebar);
            border-bottom: 1px solid var(--color-border);
        }
        
        .sidebar-header svg {
            width: 100%;
            height: auto;
            max-height: 80px;
            display: block;
        }
        
        [data-theme="dark"] .cls-4 { fill: #ffffff !important; } /* Fix SVG Dark Mode */

        .sidebar-menu {
            list-style: none;
            padding: 20px 15px;
            flex-grow: 1;
        }

        .sidebar-menu li { margin-bottom: 8px; }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            text-decoration: none;
            color: var(--color-text-muted);
            border-radius: 8px;
            transition: all 0.2s;
            font-weight: 600;
            cursor: pointer;
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: rgba(32, 226, 200, 0.15);
            color: var(--color-header); 
        }
        
        [data-theme="dark"] .sidebar-menu a:hover, 
        [data-theme="dark"] .sidebar-menu a.active {
             color: var(--color-accent);
        }

        .sidebar-menu i { margin-right: 15px; width: 20px; text-align: center; }

        /* --- Main Content --- */
        .main-content {
            margin-left: var(--sidebar-width);
            flex-grow: 1;
            padding: 40px;
            width: calc(100% - var(--sidebar-width));
        }

        /* Header Content */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }

        h1, h2 {
            font-family: var(--font-header);
            color: var(--color-header);
            font-weight: 700;
            text-transform: uppercase;
        }
        [data-theme="dark"] h1, [data-theme="dark"] h2 { color: var(--color-accent); }
        
        h1 { font-size: 2.2rem; letter-spacing: -0.5px; }
        .highlight { color: var(--color-accent); }

        /* Views (Tab System) */
        .view-section { display: none; animation: fadeIn 0.4s ease; }
        .view-section.active { display: block; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Cards */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background-color: var(--color-card-bg);
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.04);
            border: 1px solid var(--color-border);
            transition: transform 0.2s ease;
        }
        .card:hover { transform: translateY(-3px); }
        .card-title { font-size: 0.85rem; color: var(--color-text-muted); text-transform: uppercase; font-weight: 600; margin-bottom: 10px; }
        .card-value { font-size: 2.2rem; font-weight: 700; color: var(--color-header); font-family: var(--font-header); }
        [data-theme="dark"] .card-value { color: #fff; }
        .trend-bad { color: #e74c3c !important; } 
        .trend-good { color: #20E2C8 !important; } 

        /* Charts & Tables */
        .chart-container {
            background-color: var(--color-card-bg);
            padding: 25px;
            border-radius: 8px;
            border: 1px solid var(--color-border);
            height: 500px;
            position: relative;
            margin-bottom: 30px;
        }
        
        .table-container {
            background-color: var(--color-card-bg);
            padding: 25px;
            border-radius: 8px;
            border: 1px solid var(--color-border);
            overflow-x: auto;
        }

        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; white-space: nowrap; }
        th { text-align: left; padding: 15px; background-color: var(--color-table-header); color: var(--color-header); font-family: var(--font-header); text-transform: uppercase; border-bottom: 2px solid var(--color-accent); }
        [data-theme="dark"] th { color: var(--color-accent); }
        td { padding: 15px; border-bottom: 1px solid var(--color-border); color: var(--color-text); }
        tr:hover td { background-color: rgba(0,0,0,0.02); }
        [data-theme="dark"] tr:hover td { background-color: rgba(255,255,255,0.02); }

        .badge-avg { background-color: rgba(32, 226, 200, 0.2); color: var(--color-header); padding: 4px 8px; border-radius: 4px; font-weight: 700; }
        [data-theme="dark"] .badge-avg { color: var(--color-accent); }

        .btn { background-color: var(--color-accent); color: #231372; padding: 10px 24px; border-radius: 4px; text-decoration: none; font-weight: 600; border: none; cursor: pointer; }
        .btn:hover { filter: brightness(1.1); }

        /* Toggle Switch */
        .theme-toggle-container { padding: 20px; border-top: 1px solid var(--color-border); display: flex; justify-content: center; align-items: center; margin-top: auto; }
        .switch { position: relative; display: inline-block; width: 50px; height: 26px; margin: 0 10px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--color-accent); }
        input:checked + .slider:before { transform: translateX(24px); }

        /* SVG Styles */
        .cls-1{fill:none;}.cls-3{fill:url(#Gradiente_sem_nome_10);}.cls-4{fill:#24282a;}.cls-5{clip-path:url(#clippath);}

    </style>
</head>
<body>

    <nav class="sidebar">
        <div class="sidebar-header">
             <svg id="Camada_2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 837.7 245.66">
                <defs>
                    <linearGradient id="Gradiente_sem_nome_10" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" stop-color="#231372"/>
                        <stop offset="100%" stop-color="#20E2C8"/>
                    </linearGradient>
                    <clipPath id="clippath"><rect class="cls-1" x="546.28" y="39.03" width="110.43" height="113"/></clipPath>
                </defs>
                <g id="Camada_1">
                    <path class="cls-4" d="M452.05,129.69v18.74c0,1.99-1.61,3.6-3.6,3.6h-67.98c-1.99,0-3.6-1.61-3.6-3.6h0V42.63c0-1.99,1.61-3.6,3.6-3.6h20.9c1.99,0,3.6,1.61,3.6,3.6h0v83.46h43.47c1.99,0,3.6,1.61,3.61,3.59h0Z"/>
                    <path class="cls-4" d="M821.22,116.37l-2.89-5.46c17.91-12.4,22.38-36.97,9.99-54.88-7.37-10.65-19.49-17-32.44-17h-41.65c-1.99,0-3.6,1.61-3.6,3.6v105.8c0,1.99,1.61,3.6,3.6,3.6h20.81c2.04,0,3.7-1.66,3.7-3.7v-30.56c0-.77.63-1.4,1.4-1.4h8.8c.52,0,1,.29,1.24.75l.23.43,17.21,32.51c.64,1.22,1.91,1.98,3.29,1.98h23.18c2,0,3.62-1.63,3.62-3.63,0-.59-.15-1.17-.42-1.69l-16.06-30.34ZM805.1,85.93c-2.59,4.22-7.18,6.79-12.13,6.78h-14.24v-28.46h14.9v.02c7.86.37,13.93,7.03,13.56,14.89-.11,2.4-.83,4.73-2.09,6.78h0Z"/>
                    <path class="cls-4" d="M370.4,140.66c.53.99.24,2.22-.67,2.87-26.46,18.91-63.23,12.79-82.14-13.66-18.91-26.46-12.79-63.23,13.66-82.14,20.48-14.64,47.99-14.64,68.47,0,.91.66,1.19,1.88.67,2.88l-10.45,19.73c-.93,1.76-3.11,2.42-4.87,1.49-.2-.1-.38-.23-.55-.36-13.36-10.51-32.71-8.21-43.22,5.15-10.51,13.36-8.21,32.71,5.15,43.22,11.17,8.79,26.91,8.79,38.08,0,1.55-1.24,3.82-.99,5.06.57.14.17.26.36.37.56l10.44,19.73Z"/>
                    <path class="cls-4" d="M487.03,64.97v18.73h37.96c1.99,0,3.6,1.61,3.6,3.6v16.46c0,1.99-1.61,3.6-3.6,3.6h-37.96v18.73h49.15c1.99,0,3.6,1.61,3.6,3.6v18.74c0,1.99-1.61,3.6-3.6,3.6h-73.66c-1.99,0-3.6-1.61-3.6-3.6V42.63c0-1.99,1.61-3.6,3.6-3.6h73.66c1.99,0,3.6,1.61,3.6,3.6v18.65c0,2.04-1.65,3.69-3.69,3.69h-49.06Z"/>
                    <path class="cls-4" d="M691.37,64.97v18.73h37.96c1.99,0,3.6,1.61,3.6,3.6v16.46c0,1.99-1.61,3.6-3.6,3.6h-37.96v18.73h49.15c1.99,0,3.6,1.61,3.6,3.6v18.74c0,1.99-1.61,3.6-3.6,3.6h-73.66c-1.99,0-3.6-1.61-3.6-3.6V42.63c0-1.99,1.61-3.6,3.6-3.6h73.66c1.99,0,3.6,1.61,3.6,3.6v18.65c0,2.04-1.65,3.69-3.69,3.69h-49.06Z"/>
                    <g class="cls-5"><path class="cls-4" fill="url(#Gradiente_sem_nome_10)" d="M656.55,42.1l-42.22,107.61c-.55,1.4-1.9,2.32-3.41,2.32h-18.86c-1.51,0-2.86-.92-3.41-2.32l-42.22-107.61c-.45-1.15.11-2.46,1.27-2.91.26-.1.54-.16.82-.16h24.31c1.54,0,2.92.96,3.45,2.41l25.21,69.57,15.99-44.09c.27-.74-.12-1.55-.85-1.82-.15-.06-.32-.08-.48-.08h-15.82c-1.24,0-2.25-1-2.25-2.25,0-.26.05-.52.13-.77l7.45-20.56c.53-1.45,1.9-2.41,3.44-2.41h45.35c1.24,0,2.25,1.01,2.25,2.25,0,.28-.05.56-.16.82"/></g>
                    <path class="cls-4" d="M310.46,207.36c0,.24-.09.46-.27.62h-6.76c-.33,0-.66-.11-.92-.32l-1.57-4.57h-12.07l-1.55,4.55c-.09.33-.29.62-.57.82h-6.74c-.28.02-.55-.06-.77-.23l12.72-32.27c.14-.34.38-.64.68-.86h5.02c.34,0,.67.12.94.32l12.69,32.29c.07.17.11.36.12.55M297.1,195.31l-3.6-10.55-3.6,10.55h7.2Z"/>
                    <path class="cls-4" d="M338.14,174.64c0-.34.13-.66.37-.89h10.81c3.16-.05,6.28.71,9.06,2.23,2.61,1.44,4.77,3.58,6.23,6.19,1.52,2.76,2.29,5.86,2.24,9.01.05,3.14-.72,6.23-2.24,8.98-1.46,2.6-3.61,4.74-6.23,6.17-2.78,1.51-5.9,2.27-9.06,2.21h-10.81c-.7,0-1.26-.56-1.26-1.26h0v-32.27ZM350.21,199.97c3.23.04,6.21-1.71,7.74-4.55.77-1.42,1.16-3.01,1.14-4.62.02-1.66-.37-3.3-1.14-4.76-1.5-2.87-4.5-4.65-7.74-4.59l-3.43.02v18.5h3.43Z"/>
                    <path class="cls-4" d="M425.13,173.56c.18.15.28.38.26.62h0l-12.72,32.27c-.13.35-.36.65-.65.87-.27.21-.6.32-.94.32h-5.02c-.35,0-.68-.12-.95-.33l-12.67-32.29c-.07-.17-.11-.36-.12-.55,0-.23.09-.46.26-.61h0c.22-.16.49-.25.76-.23h6.76c.34,0,.67.11.94.32l7.55,21,7.67-21.05c.1-.34.31-.63.6-.83h6.76"/>
                    <path class="cls-4" d="M452.9,174.64c-.02-.34.1-.68.33-.93h22.4c.34-.02.68.1.93.33v5.48c.02.34-.1.67-.32.93h-15.12v5.76h11.48c.37-.02.73.1,1.01.35v4.53c.02.35-.12.69-.37.93h-11.48v5.93h15.12c.47-.03.92.13,1.27.44v5.14c.02.34-.11.66-.35.9h-22.85c-.34.02-.67-.09-.93-.32v-32.29Z"/>
                    <path class="cls-4" d="M534.29,207.26c0,.51-.4.92-.9.93h-7.12c-.29.02-.58-.06-.82-.23l-5.1-9.81h-3.55v9.62c.02.34-.11.68-.35.93h-6.1c-.34.02-.67-.1-.92-.33v-32.29c-.01-.34.11-.66.35-.9h12.22c2.26-.04,4.49.47,6.5,1.49,1.85.95,3.38,2.42,4.42,4.23,1.09,1.94,1.64,4.14,1.59,6.36.03,2.04-.46,4.06-1.42,5.86-.92,1.71-2.29,3.13-3.96,4.12l6.1,11.31M516.12,189.85h4.45c.77.01,1.52-.2,2.18-.6.64-.39,1.16-.95,1.51-1.62.37-.69.56-1.46.55-2.24.01-.76-.18-1.51-.55-2.18-.35-.63-.88-1.15-1.51-1.5h-4.45v8.67Z"/>
                    <path class="cls-4" d="M561.13,174.64c-.02-.34.1-.68.33-.93h23.24c.34-.02.68.1.93.33v5.74c.02.35-.1.68-.33.94h-7.31v25.55c.02.35-.1.69-.33.94h-6.1c-.64.06-1.2-.4-1.26-1.04v-25.55h-7.29c-.34.02-.68-.1-.93-.35v-5.74Z"/>
                    <path class="cls-4" d="M623.9,207.24c.07.44-.23.86-.68.93h-6.79c-.46.06-.87-.27-.93-.73v-32.94c-.06-.44.26-.85.7-.9h6.79c.44-.06.84.25.9.69v32.94Z"/>
                    <path class="cls-4" d="M652.91,204.31c.01-.3.1-.6.26-.86l2.81-5.05c.2-.41.62-.67,1.07-.67.27.01.54.08.79.19,1.47.68,2.99,1.24,4.55,1.68,1.51.41,3.06.61,4.62.61,1.06.03,2.12-.21,3.06-.7.75-.34,1.24-1.07,1.25-1.89,0-.58-.25-1.13-.7-1.5-.6-.49-1.27-.86-2-1.12-.87-.33-2.09-.73-3.66-1.19-2.07-.58-4.08-1.36-6-2.34-1.43-.74-2.65-1.83-3.54-3.18-.87-1.47-1.29-3.15-1.22-4.86-.05-2.05.57-4.07,1.76-5.74,1.2-1.62,2.82-2.88,4.69-3.63,2.01-.83,4.17-1.25,6.35-1.23,1.47,0,2.94.17,4.37.5,1.37.3,2.71.73,4.01,1.26,1.03.42,2.02.93,2.95,1.52.41.21.68.62.71,1.07l-2.83,5.14c-.17.38-.56.62-.98.62-.37-.02-.73-.13-1.05-.31-1.18-.62-2.41-1.14-3.68-1.56-1.23-.37-2.51-.55-3.8-.54-.91-.02-1.81.2-2.6.64-.64.29-1.07.92-1.1,1.62,0,.7.47,1.3,1.41,1.8,1.45.69,2.97,1.25,4.53,1.65,2.14.6,4.22,1.37,6.24,2.3,1.52.71,2.84,1.79,3.83,3.14,1.03,1.52,1.53,3.33,1.45,5.16.04,2.1-.58,4.15-1.79,5.87-1.23,1.71-2.91,3.04-4.86,3.85-2.15.91-4.46,1.36-6.79,1.33-2.35,0-4.68-.31-6.95-.9-2.2-.56-4.31-1.43-6.26-2.6"/>
                    <path class="cls-4" d="M717.37,207.24c.07.44-.23.86-.68.93h-6.79c-.46.06-.87-.27-.93-.73v-32.94c-.06-.44.26-.85.7-.9h6.79c.44-.06.84.24.9.68v32.94Z"/>
                    <path class="cls-4" d="M778.6,173.61c.17.19.26.44.24.69v32.96c.02.26-.07.51-.25.69-.19.17-.43.25-.68.24h-6.48c-.75,0-1.45-.41-1.81-1.07l-13.38-20.36v20.5c.02.25-.07.51-.25.69-.19.17-.43.25-.68.24h-6.79c-.25.01-.49-.07-.68-.24v-32.95c-.02-.25.07-.51.25-.69h7.03c.75.04,1.42.46,1.79,1.12l12.88,19.15v-19.34c-.02-.25.07-.5.24-.69h6.79"/>
                    <path class="cls-4" d="M827.49,200.03c.61-.16,1.2-.37,1.76-.66v-6.14c-.01-.34.12-.67.37-.91.24-.23.56-.36.89-.36h5.98c.32,0,.64.13.86.37v11.36c0,.26-.07.51-.19.74-.1.23-.27.42-.48.55-1.63.97-3.4,1.7-5.25,2.14-1.96.55-3.98.85-6.01.88-3.24.03-6.43-.79-9.24-2.4-2.75-1.56-5.04-3.82-6.63-6.55-1.63-2.77-2.47-5.93-2.44-9.15-.04-6.48,3.42-12.47,9.05-15.67,2.81-1.61,6-2.44,9.24-2.41,1.91.02,3.81.34,5.62.94,1.76.51,3.41,1.35,4.86,2.47.33.23.53.62.52,1.02l-3.5,5.26c-.19.32-.53.51-.91.5-.3,0-.59-.1-.81-.31-.78-.65-1.68-1.13-2.64-1.44-.93-.33-1.92-.5-2.91-.51-1.71-.02-3.39.42-4.88,1.26-1.45.82-2.66,2-3.5,3.44-1.71,2.96-1.71,6.61,0,9.57.84,1.44,2.05,2.62,3.5,3.44,1.49.84,3.17,1.28,4.88,1.26"/>
                </g>
            </svg>
        </div>
        
        <ul class="sidebar-menu">
            <li><a data-view="dashboard" class="active"><i class="fas fa-columns"></i> Dashboard</a></li>
            <li><a data-view="performance"><i class="fas fa-chart-pie"></i> Performance N1</a></li>
            <li><a data-view="history"><i class="fas fa-history"></i> Histórico 24/25</a></li>
            <li><a data-view="teams"><i class="fas fa-users"></i> Equipas</a></li>
        </ul>

        <div class="theme-toggle-container">
            <i class="fas fa-sun" style="margin-right:10px; color:var(--color-text-muted);"></i>
            <label class="switch">
                <input type="checkbox" id="theme-switch">
                <span class="slider"></span>
            </label>
            <i class="fas fa-moon" style="margin-left:10px; color:var(--color-text-muted);"></i>
        </div>
    </nav>

    <main class="main-content">
        <header>
            <div>
                <h1>Clever Advertising <span class="highlight">Dashboard</span></h1>
                <p style="color: var(--color-text-muted);">Análise de Tempo Médio de Atendimento (N1) - Quarters 2024 & 2025</p>
            </div>
            <div>
                <button class="btn"><i class="fas fa-download"></i> Exportar Relatório</button>
            </div>
        </header>

        <div id="view-dashboard" class="view-section active">
            <section class="cards-grid">
                <div class="card">
                    <div class="card-title">Média Global N1</div>
                    <div class="card-value" id="kpi-global">--</div>
                    <div class="card-trend">Horas Totais (Avg)</div>
                </div>
                <div class="card">
                    <div class="card-title">Maior Tempo Médio</div>
                    <div class="card-value trend-bad" id="kpi-slowest-val">--</div>
                    <div class="card-trend" id="kpi-slowest-name">Categoria</div>
                </div>
                <div class="card">
                    <div class="card-title">Melhor Performance</div>
                    <div class="card-value trend-good" id="kpi-fastest-val">--</div>
                    <div class="card-trend" id="kpi-fastest-name">Categoria</div>
                </div>
                <div class="card">
                    <div class="card-title">Categorias Monitorizadas</div>
                    <div class="card-value" id="kpi-count">--</div>
                    <div class="card-trend">Ativas no período</div>
                </div>
            </section>
            <div class="chart-container">
                <h2>Evolução Top 5 (Mais Lentas)</h2>
                <canvas id="trendChart"></canvas>
            </div>
        </div>

        <div id="view-performance" class="view-section">
            <div class="chart-container" style="height: 600px;">
                <h2>Ranking Global (Tempo Médio)</h2>
                <canvas id="barChart"></canvas>
            </div>
        </div>

        <div id="view-history" class="view-section">
            <section class="table-container">
                <h2>Histórico Trimestral (Detalhado)</h2>
                <div style="overflow-x:auto; margin-top: 15px;">
                    <table id="dataTable">
                        <thead>
                            <tr>
                                <th>Categoria</th>
                                <th>Área</th>
                                <th>Média N1</th>
                                <th>Q1 '24</th>
                                <th>Q2 '24</th>
                                <th>Q3 '24</th>
                                <th>Q4 '24</th>
                                <th>Q1 '25</th>
                                <th>Q2 '25</th>
                                <th>Q3 '25</th>
                                <th>Q4 '25</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </section>
        </div>

        <div id="view-teams" class="view-section">
            <div class="chart-container">
                <h2>Performance Média por Área (Equipa)</h2>
                <canvas id="teamsChart"></canvas>
            </div>
            <div style="margin-top:20px; display:grid; grid-template-columns:repeat(auto-fit, minmax(200px,1fr)); gap:20px;" id="teams-cards">
                </div>
        </div>

    </main>

    <script>
        // --- DADOS ---
        const detailsData = [
            {"Category": "Access", "Q1_2024": 0.0, "Q2_2024": 0.0, "Q3_2024": 0.0, "Q4_2024": 0.01, "Q1_2025": 0.0, "Q2_2025": 16.65, "Q3_2025": 12.66, "Q4_2025": 17.71, "Average_N1": 15.68, "Area": "Infra"},
            {"Category": "Acessories / Notebook", "Q1_2024": 0.0, "Q2_2024": 0.0, "Q3_2024": 0.0, "Q4_2024": 0.0, "Q1_2025": 342.59, "Q2_2025": 21.78, "Q3_2025": 68.82, "Q4_2025": 10.58, "Average_N1": 110.94, "Area": "Infra"},
            {"Category": "Advertising", "Q1_2024": 0.0, "Q2_2024": 0.0, "Q3_2024": 0.0, "Q4_2024": 0.0, "Q1_2025": 0.0, "Q2_2025": 1.12, "Q3_2025": 1.79, "Q4_2025": 0.0, "Average_N1": 0.97, "Area": "Service"},
            {"Category": "CleverAds", "Q1_2024": 0.0, "Q2_2024": 0.0, "Q3_2024": 0.0, "Q4_2024": 0.0, "Q1_2025": 0.0, "Q2_2025": 0.52, "Q3_2025": 0.51, "Q4_2025": 0.0, "Average_N1": 0.34, "Area": "Service"},
            {"Category": "Traffic", "Q1_2024": 0.0, "Q2_2024": 0.0, "Q3_2024": 0.0, "Q4_2024": 0.0, "Q1_2025": 0.0, "Q2_2025": 1.96, "Q3_2025": 1.59, "Q4_2025": 0.0, "Average_N1": 1.18, "Area": "Service"},
            {"Category": "Implementation", "Q1_2024": 0.0, "Q2_2024": 0.0, "Q3_2024": 0.0, "Q4_2024": 0.0, "Q1_2025": 0.0, "Q2_2025": 2.16, "Q3_2025": 1.67, "Q4_2025": 0.0, "Average_N1": 1.28, "Area": "Service"},
            {"Category": "Resolution AUTO", "Q1_2024": 0.0, "Q2_2024": 0.0, "Q3_2024": 0.0, "Q4_2024": 0.0, "Q1_2025": 0.0, "Q2_2025": 0.0, "Q3_2025": 66.67, "Q4_2025": 1.86, "Average_N1": 22.84, "Area": "Service"},
            {"Category": "Jira /Confluence", "Q1_2024": 0.0, "Q2_2024": 0.0, "Q3_2024": 0.0, "Q4_2024": 0.0, "Q1_2025": 0.0, "Q2_2025": 0.23, "Q3_2025": 0.25, "Q4_2025": 0.0, "Average_N1": 0.16, "Area": "Service"},
            {"Category": "PowerBI", "Q1_2024": 0.0, "Q2_2024": 0.0, "Q3_2024": 0.0, "Q4_2024": 0.0, "Q1_2025": 0.0, "Q2_2025": 6.11, "Q3_2025": 66.17, "Q4_2025": 0.0, "Average_N1": 24.09, "Area": "Service"},
            {"Category": "Network", "Q1_2024": 0.0, "Q2_2024": 0.0, "Q3_2024": 0.0, "Q4_2024": 0.0, "Q1_2025": 0.0, "Q2_2025": 1.21, "Q3_2025": 1.80, "Q4_2025": 0.0, "Average_N1": 1.00, "Area": "Infra"},
            {"Category": "Printer", "Q1_2024": 0.0, "Q2_2024": 0.0, "Q3_2024": 0.0, "Q4_2024": 0.0, "Q1_2025": 0.0, "Q2_2025": 0.0, "Q3_2025": 2.05, "Q4_2025": 0.0, "Average_N1": 0.68, "Area": "Infra"},
            {"Category": "B2B / Approvals / Commission", "Q1_2024": 0.0, "Q2_2024": 0.0, "Q3_2024": 0.0, "Q4_2024": 0.0, "Q1_2025": 0.0, "Q2_2025": 5.32, "Q3_2025": 0.60, "Q4_2025": 0.0, "Average_N1": 1.97, "Area": "Core"},
            {"Category": "Antivirus", "Q1_2024": 0.0, "Q2_2024": 0.0, "Q3_2024": 0.0, "Q4_2024": 0.0, "Q1_2025": 0.0, "Q2_2025": 0.17, "Q3_2025": 0.29, "Q4_2025": 0.0, "Average_N1": 0.15, "Area": "Infra"},
            {"Category": "Improvement", "Q1_2024": 0.0, "Q2_2024": 0.0, "Q3_2024": 0.0, "Q4_2024": 0.0, "Q1_2025": 0.0, "Q2_2025": 0.0, "Q3_2025": 485.77, "Q4_2025": 193.79, "Average_N1": 339.78, "Area": "Service"},
            {"Category": "RPA", "Q1_2024": 0.0, "Q2_2024": 0.0, "Q3_2024": 0.0, "Q4_2024": 0.0, "Q1_2025": 0.0, "Q2_2025": 28.06, "Q3_2025": 78.97, "Q4_2025": 0.0, "Average_N1": 53.52, "Area": "Delivery"},
            {"Category": "Biometric Control", "Q1_2024": 0.0, "Q2_2024": 0.0, "Q3_2024": 0.0, "Q4_2024": 0.0, "Q1_2025": 0.0, "Q2_2025": 54.94, "Q3_2025": 33.97, "Q4_2025": 31.51, "Average_N1": 40.14, "Area": "Corporate"},
            {"Category": "New Services", "Q1_2024": 0.0, "Q2_2024": 0.0, "Q3_2024": 0.0, "Q4_2024": 0.0, "Q1_2025": 0.0, "Q2_2025": 2.05, "Q3_2025": 2.31, "Q4_2025": 0.0, "Average_N1": 1.45, "Area": "Core"},
            {"Category": "New Solution Request", "Q1_2024": 0.0, "Q2_2024": 0.0, "Q3_2024": 0.0, "Q4_2024": 0.0, "Q1_2025": 0.0, "Q2_2025": 5.81, "Q3_2025": 5.26, "Q4_2025": 16.91, "Average_N1": 9.33, "Area": "Service"},
            {"Category": "Data Base", "Q1_2024": 0.0, "Q2_2024": 0.0, "Q3_2024": 0.0, "Q4_2024": 0.0, "Q1_2025": 0.0, "Q2_2025": 0.0, "Q3_2025": 2.17, "Q4_2025": 0.0, "Average_N1": 0.72, "Area": "Infra"},
            {"Category": "Information Security", "Q1_2024": 0.0, "Q2_2024": 0.0, "Q3_2024": 0.0, "Q4_2024": 0.0, "Q1_2025": 0.0, "Q2_2025": 0.0, "Q3_2025": 0.28, "Q4_2025": 0.0, "Average_N1": 0.09, "Area": "Infra"}
        ];

        const summaryData = {"Average_N1": 49.19};

        const top5Data = [
            {"Category": "Improvement", "Q1_2024": 0.0, "Q2_2024": 0.0, "Q3_2024": 0.0, "Q4_2024": 0.0, "Q1_2025": 0.0, "Q2_2025": 0.0, "Q3_2025": 485.77, "Q4_2025": 193.79},
            {"Category": "Acessories / Notebook", "Q1_2024": 0.0, "Q2_2024": 0.0, "Q3_2024": 0.0, "Q4_2024": 0.0, "Q1_2025": 342.59, "Q2_2025": 21.78, "Q3_2025": 68.82, "Q4_2025": 10.58},
            {"Category": "RPA", "Q1_2024": 0.0, "Q2_2024": 0.0, "Q3_2024": 0.0, "Q4_2024": 0.0, "Q1_2025": 0.0, "Q2_2025": 28.06, "Q3_2025": 78.97, "Q4_2025": 0.0},
            {"Category": "Biometric Control", "Q1_2024": 0.0, "Q2_2024": 0.0, "Q3_2024": 0.0, "Q4_2024": 0.0, "Q1_2025": 0.0, "Q2_2025": 54.94, "Q3_2025": 33.97, "Q4_2025": 31.51},
            {"Category": "PowerBI", "Q1_2024": 0.0, "Q2_2024": 0.0, "Q3_2024": 0.0, "Q4_2024": 0.0, "Q1_2025": 0.0, "Q2_2025": 6.11, "Q3_2025": 66.17, "Q4_2025": 0.0}
        ];

        // --- APP LOGIC ---
        const themeSwitch = document.getElementById('theme-switch');
        const body = document.body;
        let trendChartInstance = null;
        let barChartInstance = null;
        let teamsChartInstance = null;

        document.addEventListener('DOMContentLoaded', () => {
            setupNavigation();
            populateCards();
            initCharts();
            initTable();
            initTeamsView(); // Nova função para equipas
        });

        // Navigation Logic (Tab System)
        function setupNavigation() {
            const links = document.querySelectorAll('.sidebar-menu a');
            const views = document.querySelectorAll('.view-section');

            links.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    
                    // Remove active class
                    links.forEach(l => l.classList.remove('active'));
                    views.forEach(v => v.classList.remove('active'));

                    // Add active class
                    link.classList.add('active');
                    const viewId = `view-${link.dataset.view}`;
                    document.getElementById(viewId).classList.add('active');
                });
            });
        }

        // Toggle Theme
        themeSwitch.addEventListener('change', () => {
            if (themeSwitch.checked) {
                body.setAttribute('data-theme', 'dark');
                updateChartsTheme(true);
            } else {
                body.setAttribute('data-theme', 'light');
                updateChartsTheme(false);
            }
        });

        function populateCards() {
            document.getElementById('kpi-global').innerText = summaryData.Average_N1 + 'h';
            const sorted = [...detailsData].sort((a, b) => b.Average_N1 - a.Average_N1);
            const slowest = sorted[0];
            const activeCats = sorted.filter(d => d.Average_N1 > 0.05);
            const fastest = activeCats[activeCats.length - 1];

            if(slowest) {
                document.getElementById('kpi-slowest-val').innerText = slowest.Average_N1 + 'h';
                document.getElementById('kpi-slowest-name').innerText = slowest.Category;
            }
            if(fastest) {
                document.getElementById('kpi-fastest-val').innerText = fastest.Average_N1 + 'h';
                document.getElementById('kpi-fastest-name').innerText = fastest.Category;
            }
            document.getElementById('kpi-count').innerText = detailsData.length;
        }

        function initCharts() {
            const ctxTrend = document.getElementById('trendChart').getContext('2d');
            const ctxBar = document.getElementById('barChart').getContext('2d');
            
            const quarters = ['Q1_2024', 'Q2_2024', 'Q3_2024', 'Q4_2024', 'Q1_2025', 'Q2_2025', 'Q3_2025', 'Q4_2025'];
            const quarterLabels = ['Q1 24', 'Q2 24', 'Q3 24', 'Q4 24', 'Q1 25', 'Q2 25', 'Q3 25', 'Q4 25'];
            const brandColors = ['#231372', '#20E2C8', '#6106AF', '#E74C3C', '#F39C12'];

            const datasetsTrend = top5Data.map((item, index) => {
                return {
                    label: item.Category,
                    data: quarters.map(q => item[q]),
                    borderColor: brandColors[index % brandColors.length],
                    backgroundColor: brandColors[index % brandColors.length],
                    tension: 0.3,
                    fill: false,
                    borderWidth: 2
                };
            });

            trendChartInstance = new Chart(ctxTrend, {
                type: 'line',
                data: { labels: quarterLabels, datasets: datasetsTrend },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Horas' }, grid: { color: '#e0e0e0' } },
                        x: { grid: { display: false } }
                    }
                }
            });

            const sortedBarData = [...detailsData].sort((a, b) => b.Average_N1 - a.Average_N1);
            
            barChartInstance = new Chart(ctxBar, {
                type: 'bar',
                data: {
                    labels: sortedBarData.map(d => d.Category),
                    datasets: [{
                        label: 'Média N1 (Horas)',
                        data: sortedBarData.map(d => d.Average_N1),
                        backgroundColor: '#20E2C8',
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { beginAtZero: true, grid: { color: '#e0e0e0' } },
                        y: { grid: { display: false } }
                    }
                }
            });
        }

        // Lógica para a View "Equipas"
        function initTeamsView() {
            const ctxTeams = document.getElementById('teamsChart').getContext('2d');
            const teamsData = {};
            const teamsCount = {};

            // Calcular médias por Área
            detailsData.forEach(d => {
                if (!teamsData[d.Area]) {
                    teamsData[d.Area] = 0;
                    teamsCount[d.Area] = 0;
                }
                teamsData[d.Area] += d.Average_N1;
                teamsCount[d.Area]++;
            });

            const labels = Object.keys(teamsData);
            const values = labels.map(area => (teamsData[area] / teamsCount[area]).toFixed(2));

            teamsChartInstance = new Chart(ctxTeams, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Média por Área (h)',
                        data: values,
                        backgroundColor: ['#231372', '#20E2C8', '#6106AF', '#E74C3C'],
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, grid: { color: '#e0e0e0' } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        function updateChartsTheme(isDark) {
            const textColor = isDark ? '#ecf0f1' : '#24282A';
            const gridColor = isDark ? '#2c3036' : '#e0e0e0';
            [trendChartInstance, barChartInstance, teamsChartInstance].forEach(chart => {
                if(chart) {
                    chart.options.scales.x.ticks.color = textColor;
                    chart.options.scales.y.ticks.color = textColor;
                    if(chart.options.scales.x.grid) chart.options.scales.x.grid.color = gridColor;
                    if(chart.options.scales.y.grid) chart.options.scales.y.grid.color = gridColor;
                    if(chart.options.plugins.legend) chart.options.plugins.legend.labels.color = textColor;
                    chart.update();
                }
            });
        }

        function initTable() {
            const tbody = document.querySelector('#dataTable tbody');
            let html = '';
            detailsData.forEach(row => {
                html += `<tr>
                    <td style="font-weight:600; color: var(--color-header);">${row.Category}</td>
                    <td><span style="font-size:0.85em; opacity:0.8;">${row.Area}</span></td>
                    <td><span class="badge-avg">${row.Average_N1} h</span></td>
                    <td>${row.Q1_2024}</td>
                    <td>${row.Q2_2024}</td>
                    <td>${row.Q3_2024}</td>
                    <td>${row.Q4_2024}</td>
                    <td>${row.Q1_2025}</td>
                    <td>${row.Q2_2025}</td>
                    <td>${row.Q3_2025}</td>
                    <td>${row.Q4_2025}</td>
                </tr>`;
            });
            tbody.innerHTML = html;
        }
    </script>
</body>
</html>
